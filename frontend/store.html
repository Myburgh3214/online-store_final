<!DOCTYPE html>
<head>
  <html>
  <title>Store - Online Store</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/stylesheet.css">
  <script src="scripts/requestHandler.js"></script>
  <script src="scripts/phpSession.js"></script>
</head>

<body id="myPage">
  <!-- Navbar -->
  <div class="w3-top">
    <div class="w3-bar w3-theme-d2 w3-left-align">

      <a href="index.html" class="w3-bar-item w3-button w3-teal"><i class="fa fa-home w3-margin-right"></i>Home</a>
      <a href="store.html" class="w3-bar-item w3-button w3-hover-white">Store</a>
      <a href="galleryPage.html" class="w3-bar-item w3-button w3-hover-white">Gallery</a>
      <a href="about.html" class="w3-bar-item w3-button w3-hover-white">About Us</a>
      <a href="contact.html" class="w3-bar-item w3-button w3-hover-white">Contact</a>
      <div id="loggedInState">
        <a href="logIn.html" class="w3-bar-item w3-button w3-hover-white">Login</a>
      </div>
      <a href="javascript:window.showCart();" class="w3-bar-item w3-button w3-hover-white">Cart/Checkout</a>
    </div>
  </div>

  <!-- Team Container -->
  <!-- <div class="w3-container w3-padding-64 w3-center" id="team">
    <img src="images/koekieblom.jpg">
  </div> -->


  <div class="basket">
    <h2>Shop With Ease</h2>
    <div class="card2-container" id="products-list">
    </div>
  </div>
  <!-- Container -->
  <div id="clean-cart" class="clean-cart">
    <a href="javascript:window.hideCart();">HIDE</a>
    <h4>MY CART</h4>
    <div class="clean-cart-items">
      <table id="cart-table">
        <thead id="cart-table-header">
          <th class="name-col">Product Name</th>
          <th class="quantity-col">Quantity</th>
          <th class="price-col">Price</th>
        </thead>
        <tbody id="clean-cart-body"></tbody>
      </table>
    </div>
    <div style="text-align:right;">
      <div style="padding:10px;">
        <td>Total:</td>
        <td><span id="clean-cart-total">R0.00</span></td>
      </div>
      <div style="float: right; padding: 10px">
        <button id="checkout" onclick="placeOrder()">Place Order</button>
      </div>
    </div>
    <script>
      // handle cart code
      function placeOrder() {
        window.cart.placeOrder(result => {
          result.text().then(console.log)
        });
      }
      function cartItemQtyChangeEvent (e) {
        let qty = Number.parseInt(e.value);
        if (qty < 1 || isNaN(qty))
          qty = 1;
        window.cart.updateOrAddItemToCart(e.getAttribute('productId'), qty);
      }
      window.cartUpdated = (newCart) => {
        let newHtml = '';

        for (let cartItem of newCart.getItems()) {
          let product = cartItem.getProduct();
          let sneakyId = `cart-product-qty-field-${product.id}`;
          newHtml += `<tr><td>${product.name}</td><td>
            <input type="number" value="${cartItem.getQty()}" style="width: 40px;" productId="${product.id}" onchange="cartItemQtyChangeEvent(this)" />
            <a href="javascript:window.cart.removeItemFromCart('${product.id}');">x</a>
            </td><td>R${cartItem.priceTotal().toFixed(2)}</td></tr>`;
        }

        document.getElementById('clean-cart-body').innerHTML = newHtml;
        document.getElementById('clean-cart-total').innerText = `R${newCart.getTotal().toFixed(2)}`;
      }
    </script>
  </div>

  
  <footer>
    <p class="poweredBy">Powered by MEEE</p>

    <div style="position:relative;bottom:100px;z-index:1;" class="w3-tooltip w3-right" >
      <span class="w3-text w3-padding w3-teal w3-hide-small">Go To Top</span>
      <a class="w3-button w3-theme" href="javascript:window.triggerScrollToTop();" id="simplescrollup__button"><span class="w3-xlarge">
          <i class="fa fa-chevron-circle-up"></i></span></a>
    </div>
    <!-- <a href="javascript:window.triggerScrollToTop();" id="simplescrollup__button" class="simplescrollup__button simplescrollup__button--hide">Scroll to top</a> -->
  </footer>
  <link rel="stylesheet" href="css/footer.css">
  <script async src="scripts/simplescrollup.js"></script>

  <script src="scripts/storeAndCart.js"></script>
  <script>
    window.productsReady = (products) => {
      let singleProduct = false;
      if (window.location.hash !== '' && window.location.hash !== '#') {
        singleProduct = window.location.hash.substring(1);
      }
      let newHtml = '';
      for (let product of products) {
        if (singleProduct !== false) {
          if (singleProduct !== product.id) continue;
          singleProduct = product;
        }

        newHtml += `<div class="card">
            <p class="product-name" >${product.name}</p>
            <p class="product-description">${product.description}</p>
            <p class="product-price" >R${product.price}</p>`;
        if (singleProduct === false)
          newHtml +=`<button onclick="window.goToProduct('${product.id}')">VIEW ITEM</button>`
        newHtml += `<button onclick="addProductToCart('${product.id}', '${product.name}')" >ADD TO CART</button>
          </div>`;
      }
      document.getElementById('products-list').innerHTML = newHtml;
      if (singleProduct !== false) {
        document.getElementsByTagName('title')[0].innerText = `${singleProduct.name} - Online Store`;
      }
    };
    function addProductToCart(productId, name) {
      window.cart.addItemToCart(productId);
      window.showCart();
      //alert('Added 1x '+name+' to your cart');
      /*postRequest('orders', {
          backpack: document.getElementById('add-to-cart').value,
        },
        result => {
          if (result.status === 202) {
           document.getElementById('add-to-cart').value = "";
            alert('product added!');
            return;
          }
          result.text().then(x => alert(x));
        });*/
    }
  </script>
</body>

</html>